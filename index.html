<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nima Fakhrayi Mofrad â€” Academic CV</title>
  <meta name="description" content="Academic CV of Nima Fakhrayi Mofrad â€” computational materials science, ML, MD/DFT, and HPC workflows." />
  <meta name="color-scheme" content="light dark" />

  <style>
    /* =========================
       THEME TOKENS (LIGHT)
       ========================= */
    :root{
      --accent:#1A318B;       /* links, headings, accents */
      --accent-ink:#16286b;
      --muted:#606870;        /* secondary text */
      --ink:#111;             /* primary text */
      --bg:#ffffff;           /* page background */
      --card-bg:#f7f9ff;      /* card background */
      --card-ink:#0b1a0b;     /* card titles */
      --rule:#1A318B;
      --link:#004d99;
      --link-hover:#003e7a;
      --border:#e0e5ff;
      --shadow: 0 10px 28px rgba(0,0,0,.06);
      --shadow-hover: 0 12px 32px rgba(0,0,0,.09);
      --radius:14px;
      --content-width: 890px;
      --outer-margin: 36px;
      --side-padding: 26px;

      /* Activity hues */
      --paper-bg:#eef7ff;   --paper-border:#d9e9ff; --paper-ink:#0b5cab;
      --talk-bg:#effaf3;    --talk-border:#d7f0e0;  --talk-ink:#136c3a;
      --pos-bg:#fff4ec;     --pos-border:#ffe1ce;   --pos-ink:#9a4b00;

      /* Collab pins */
      --c-de:#0ea5e9; --c-us:#22c55e; --c-cn:#f59e0b; --c-uk:#ef4444; --c-fi:#1A318B;
    }

    /* =========================
       THEME TOKENS (DARK)
       ========================= */
    [data-theme="dark"]{
      --accent:#9bb4ff;
      --accent-ink:#b7c6ff;
      --muted:#a0a6b3;
      --ink:#e6e9ef;
      --bg:#0e1116;
      --card-bg:#121825;
      --card-ink:#edf3ff;
      --rule:#9bb4ff;
      --link:#9bb4ff;
      --link-hover:#bcd0ff;
      --border:#26304a;
      --shadow: 0 10px 28px rgba(0,0,0,.45);
      --shadow-hover: 0 12px 32px rgba(0,0,0,.6);

      --paper-bg:#0f1b33;   --paper-border:#20305b; --paper-ink:#9bb4ff;
      --talk-bg:#0f1f19;    --talk-border:#1b3c2b;  --talk-ink:#7dd3a8;
      --pos-bg:#21180f;     --pos-border:#3b2a17;   --pos-ink:#ffb36b;

      --c-de:#60c7ff; --c-us:#4ade80; --c-cn:#fbbf24; --c-uk:#f87171; --c-fi:#9bb4ff;
    }

    /* =========================
       BASE
       ========================= */
    html, body { direction:ltr; text-align:left; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: var(--content-width);
      margin: var(--outer-margin) auto;
      padding: 0 var(--side-padding);
      line-height: 1.6;
      color: var(--ink);
      background: var(--bg);
      transition: background .25s ease, color .25s ease;
    }
	
    h1 { font-size:2rem; margin:0 0 .25rem 0; color:var(--card-ink); letter-spacing:0.2px; }
    h2 { font-size:1.1rem; margin:1.25rem 0 .35rem; color:var(--accent); text-transform:uppercase; letter-spacing:.08em; }
    p, li { font-size:.97rem; }
    a { color:var(--link); text-decoration:none; }
    a:hover { color:var(--link-hover); text-decoration:underline; }
    .rule { height:3px; width:72px; background:var(--rule); margin:.5rem 0 1rem; border-radius:2px; }

   /* =========================
     HEADER / MASTHEAD
     ========================= */
    .masthead {
      display: flex;
      flex-direction: row;
      align-items: stretch; /* make avatar stretch to match info height */
      gap: 24px;
      margin-bottom: 16px;
    }
    
    .avatar {
      width: auto;            /* width will scale based on height */
      height: 100%;           /* match height of info column */
      max-height: 180px;      /* optional cap */
      object-fit: cover;
      border-radius: 6px;     /* subtle rounding */
      border: 3px solid var(--border);
      box-shadow: 0 6px 18px rgba(0,0,0,.12);
      flex-shrink: 0;
    }
    
    .titleblock {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
      flex: 1;
    }
    
    .titleblock h1 {
      margin: 0;
      font-size: 2rem;
      line-height: 1.1;
    }
    
    .titleblock .subtitle {
      font-size: 1.1rem;
      color: var(--muted);
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .contact {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.95rem;
      color: var(--ink);
    }
    
    .contact a {
      color: var(--link);
      text-decoration: none;
    }
    
    .contact a:hover {
      text-decoration: underline;
    }
    
    /* Mobile: stack vertically */
    @media (max-width: 560px) {
      .masthead {
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }
      .avatar {
        height: 120px;
        width: 120px;
      }
      .titleblock {
        align-items: center;
        text-align: center;
      }
      .contact {
        justify-content: center;
      }
    }

    /* =========================
       CARDS / GRIDS
       ========================= */
    .bio-card, .research-card, .skills.card {
      position: relative;
      background-color: var(--card-bg);
      color: var(--ink);
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      transition: transform 0.25s ease, box-shadow 0.25s ease, background-color .2s ease;
      margin-bottom: 0rem;
      border:1px solid var(--border);
    }
    .bio-card:hover, .research-card:hover, .skills.card:hover { transform: translateY(-4px); box-shadow: var(--shadow-hover); }
    .marker {
      width:16px; height:16px; background-color: var(--accent);
      border-radius: 50%; position: absolute; top: 16px; left: 16px;
      box-shadow:0 0 0 2px #fff inset, 0 0 0 1px rgba(0,0,0,.15);
    }
    .bio-card p, .research-card p { margin-left: 30px; font-size: 0.95rem; line-height: 1.5; }
    .bio-card ul { margin-left:30px; margin-top:0.5rem; margin-bottom:0; font-size:.95rem; line-height:1.5; }
    .bio-card li { margin-bottom:0.3rem; }
    .research-card h3 { margin-top:0; margin-left:30px; font-size:1.05rem; color:var(--card-ink); }
    .research-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:1.5rem; }

    .chips { display:flex; flex-wrap:wrap; gap:8px; }
    .chip { display:inline-flex; align-items:center; gap:6px; padding:.22rem .55rem; border-radius:999px; background:rgba(155,180,255,.12); border:1px solid var(--border); font-size:.92rem; color:var(--accent-ink); font-weight:700; transition: background .2s ease; }
    .chip:hover { background:rgba(155,180,255,.2); }

    .social { display:flex; gap:10px; align-items:center; margin:.35rem 0 .2rem; transition: opacity .4s ease, transform .4s ease; }
    .social a { display:inline-flex; width:34px; height:34px; align-items:center; justify-content:center; border-radius:999px; background:var(--card-bg); border:1px solid var(--border); transition: transform .15s ease, box-shadow .15s ease, background .15s ease; }
    .social a:hover { transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.12); }
    .social svg { width:18px; height:18px; fill:var(--accent-ink); }
    .social.hidden { opacity:0; transform: translateY(-6px); pointer-events:none; }

    .subprojects { display:grid; gap:.5rem; margin-top:.5rem; }
    .subproject { display:flex; align-items:center; gap:.5rem; background:var(--talk-bg); border:1px solid var(--talk-border); border-radius:10px; padding:.45rem .6rem; text-decoration:none; color:var(--talk-ink); transition: transform .15s, box-shadow .15s, background .15s; }
    .subproject:hover { transform:translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,.12); }
    .subproject .icon { width:16px; height:16px; flex:0 0 auto; opacity:.75; }
    .subproject .title { font-weight:600; }

    /* =========================
       PRINT
       ========================= */
    @media print {
      @page{ size:A4; margin:18mm 22mm; }
      body{ max-width:none; margin:0; padding:0; background:#fff; color:#000; }
      a{ text-decoration:none; color:inherit; }
      h2{ margin-top:10pt; }
      .masthead{ grid-template-columns:1fr auto; gap:14pt; }
      .avatar{ width:110px; height:110px; border-color:#ddd; }
      .rule{ margin:.3rem 0 .7rem; }
      .bio-card, .research-card{ box-shadow:none; background:#fff; transform:none; border-color:#ddd; }
      .theme-toggle, .social { display:none !important; }
    }

    @media (max-width:760px){ .research-grid{ grid-template-columns:1fr; } .skills-grid{ grid-template-columns:1fr; } }
    @media (max-width:560px){ .masthead{ grid-template-columns:1fr; text-align:left; } .avatar{ width:112px; height:112px; } }

    /* Typewriter cursor */
    .cursor{ width:2px; height:1.2em; background:var(--accent-ink); display:inline-block; translate:0 .1em; animation:blink .9s steps(1) infinite; }
    @keyframes blink{ 50%{ opacity:0; } }
    @media (prefers-reduced-motion: reduce){ .cursor{ display:none; animation:none; } }

    /* =========================
       ACTIVITIES
       ========================= */
    .activities { margin-top:2rem; }
    .rail-shell { background: var(--card-bg); border-radius: var(--radius); padding: 8px; box-shadow: var(--shadow); border: 1px solid var(--border); overflow: hidden; }
    .activities-rail { max-height: 280px; overflow-y: auto; padding: 0 2px 6px; }
    .act-header {
      display: grid; grid-template-columns: 92px 84px 1fr auto; gap: 10px;
      padding: 10px 12px; font-weight: 700; color: var(--accent-ink);
      font-size: 0.9rem; border-bottom: 1px solid var(--border); background-color: var(--card-bg); position:sticky; top:0; z-index:5;
    }
    .act-controls { display:flex; flex-wrap:wrap; gap: 12px; margin: 0.5rem 0 1rem; }
    .pill {
      padding: 0.35rem 0.85rem; border-radius: 999px; font-weight: 700; font-size: 0.88rem; cursor: pointer;
      background: var(--card-bg); border: 1px solid var(--border); color: var(--accent-ink);
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }
    .pill:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .pill[aria-pressed="true"] { background: var(--accent); color: #fff; border-color: var(--accent-ink); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    .activity-line {
      display: grid; grid-template-columns: 92px 84px 1fr auto; align-items: center; gap: 10px;
      padding: 10px 12px; margin: 6px 4px; background: var(--bg); border-radius: var(--radius);
      border:1px solid var(--border); box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }
    .activity-line[data-type="Paper"] { border-left: 4px solid var(--paper-ink); }
    .activity-line[data-type="Talk"]  { border-left: 4px solid var(--talk-ink); }
    .activity-line[data-type="Position"] { border-left: 4px solid var(--pos-ink); }
    .activity-line:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,0,0,0.12); background-color: var(--card-bg); }
    .act-date { color: var(--muted); font-size: 0.9rem; white-space:nowrap; }
    .act-type { justify-self: start; font-weight: 700; font-size: 0.85rem; padding: 0.2rem 0.45rem; border-radius: 999px; background: rgba(155,180,255,.12); }
    .act-title { font-weight: 600; color: var(--accent-ink); font-size: 0.97rem; }
    .act-title a { color: inherit; text-decoration: none; border-bottom: 1px solid transparent; }
    .act-title a:hover { border-bottom-color: currentColor; }
    .act-link { justify-self: end; font-weight: 700; color: var(--accent); text-decoration: none; }
    .act-link:hover { text-decoration: underline; }

    @media (max-width:560px){
      .act-header, .activity-line{
        grid-template-columns: 80px 1fr;
        grid-template-areas:
          "date type"
          "title title"
          "link link";
        row-gap:4px;
      }
      .act-date { grid-area: date; }
      .act-type { grid-area: type; justify-self:end; }
      .act-title { grid-area: title; -webkit-line-clamp:2; display:-webkit-box; -webkit-box-orient: vertical; overflow: hidden; }
      .act-link { grid-area: link; justify-self:start; }
    }

    /* =========================
       COLLAB MAP
       ========================= */
    .collab-static{
      position:relative; border:1px solid var(--border); border-radius:12px; overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,.12); background:var(--bg);
      width:100%; margin:.6rem auto;
    }
    .collab-static img.map{ width:100%; height:auto; display:block; background:linear-gradient(180deg,#f4f7fb,transparent); }
    [data-theme="dark"] .collab-static img.map{ background:linear-gradient(180deg,#0e1116,transparent); filter:contrast(1.05) brightness(.95); }
    .collab-static #pins{ position:absolute; inset:0; pointer-events:auto; z-index:2; }

    .pin{ position:absolute; transform:translate(-50%,-100%); pointer-events:auto; cursor:default; outline:none;
      --stem-h: 14px; --dot-size: 10px; --ring-size: 22px; --ring2-size: 0px; z-index:1; transition:filter .15s ease, opacity .15s ease; }
    .pin:hover{ z-index:6; }
    .pin .stem{ position:absolute; left:50%; bottom:0; transform:translateX(-50%); width:0; height:var(--stem-h); border-left:2px solid currentColor; filter:drop-shadow(0 0 1px rgba(0,0,0,.2)); }
    .pin .dot{ position:absolute; left:50%; bottom: calc(var(--stem-h) - (var(--dot-size) / 2)); transform: translateX(-50%); width:var(--dot-size); height:var(--dot-size); border-radius:50%;
      background: currentColor; box-shadow:0 0 0 2px #fff inset, 0 0 0 1px rgba(0,0,0,.15); transition:transform .12s ease; z-index:2; }
    .pin:hover .dot, .pin:focus-visible .dot{ transform: translateX(-50%) scale(1.15); }
    .pin .ring{ position:absolute; left:50%; bottom: calc(var(--stem-h) - (var(--ring-size) / 2)); transform: translateX(-50%); width:var(--ring-size); height:var(--ring-size);
      border-radius:50%; border:2px solid currentColor; opacity:.85; animation:ping 1.6s ease-out infinite; z-index:1; }
    .pin .ring2{ position:absolute; left:50%; bottom: calc(var(--stem-h) - (var(--ring2-size) / 2)); transform: translateX(-50%); width:var(--ring2-size); height:var(--ring2-size);
      border-radius:50%; border:2px solid currentColor; opacity:.7; animation:pingStrong 1.6s .25s ease-out infinite; z-index:1; }
    .pin.home{ --stem-h: 16px; --dot-size: 12px; --ring-size: 28px; --ring2-size: 38px; }
    .pin.home .dot{ box-shadow:0 0 0 2px #fff inset, 0 0 0 1px rgba(0,0,0,.2), 0 0 8px rgba(0,100,0,.35); }
    @keyframes ping{ 0%{ transform:translateX(-50%) scale(.2); opacity:.85; } 70%{ transform:translateX(-50%) scale(1.5); opacity:0; } 100%{ transform:translateX(-50%) scale(1.6); opacity:0; } }
    @keyframes pingStrong{ 0%{ transform:translateX(-50%) scale(.22); opacity:.95; } 65%{ transform:translateX(-50%) scale(1.8); opacity:0; } 100%{ transform:translateX(-50%) scale(1.9); opacity:0; } }

    .collab-card{
      position:absolute; width:3.9cm; max-width: min(3.9cm, calc(100% - 24px)); background:var(--bg);
      border:1px solid var(--border); border-radius:10px; box-shadow:0 6px 22px rgba(0,0,0,.14);
      padding:.55rem .65rem .65rem; opacity:0; visibility:hidden; transition:opacity .18s ease, visibility .18s ease; z-index:10; pointer-events:auto;
    }
    .collab-card.open{ opacity:1; visibility:visible; }
    .collab-card .card-title{ font-weight:700; font-size:.9rem; margin:0 0 .2rem; color:var(--card-ink); }
    .collab-card .card-body{ font-size:.85rem; color:var(--ink); line-height:1.35; word-wrap:break-word; }
    .collab-caret{ position:absolute; top:50%; transform:translateY(-50%); width:0; height:0; filter:drop-shadow(0 1px 0 rgba(0,0,0,.08)); }
    .collab-card.place-right .collab-caret{ left:-8px; border:8px solid transparent; border-right-color:var(--bg); }
    .collab-card.place-left .collab-caret{ right:-8px; border:8px solid transparent; border-left-color:var(--bg); }
    .pin.inactive{ opacity:.55; filter:grayscale(.2); }
    .pin.inactive:hover{ opacity:1; filter:none; z-index:6; }
    .collab-card.inactive{ border-style:dashed; }
    .c-de{ color:var(--c-de) } .c-us{ color:var(--c-us) } .c-cn{ color:var(--c-cn) } .c-uk{ color:var(--c-uk) } .c-fi{ color:var(--c-fi) }
	
    .research-card .chips {
      display: flex !important;        /* make it a flex container */
      justify-content: center !important; /* center horizontally */
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      width: 100%;
      margin-left: 0;                  /* remove any inherited left offset */
      padding: 0.5rem 0 0;             /* small top spacing from card content */
      box-sizing: border-box;
      text-align: center;
    }
    
    /* keep chip appearance but ensure centering works */
    .research-card .chip {
      display: inline-flex;            /* keep them inline-like but flex for alignment */
      justify-content: center;
      align-items: center;
      padding: .22rem .55rem;
      border-radius: 999px;
      font-weight:700;
      white-space: nowrap;             /* prevent awkward wrapping of single chip text */
    }
    
    /* Some cards use `subprojects` / `.subproject` etc â€” ensure chips don't inherit left margin */
    .research-card > * { box-sizing: border-box; }
  </style>
</head>
<body>
<header class="masthead">
<img class="avatar" src="profile.jpg" alt="Portrait of Nima Fakhrayi Mofrad" loading="eager" decoding="async">
  <div class="titleblock">
    <h1>Nima Fakhrayi Mofrad</h1>
    <div class="subtitle">
      <span id="tw-text" aria-live="polite"></span>
      <span class="cursor" aria-hidden="true"></span>
    </div>

    <div class="theme-toggle">
      <button id="themeBtn" class="theme-btn" type="button" aria-pressed="false" aria-label="Toggle theme">ðŸŒ™ Night</button>
    </div>

    <div class="social hidden">
      <a href="https://www.linkedin.com/in/nima-fakhrayimofrad" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4.98 3.5A2.5 2.5 0 1 0 5 8.5a2.5 2.5 0 0 0 0-5zM3 9h4v12H3zM9 9h3.8v1.7h.1c.5-.9 1.7-1.9 3.6-1.9 3.9 0 4.6 2.6 4.6 6v6H18V16c0-1.5 0-3.5-2.1-3.5-2.1 0-2.4 1.6-2.4 3.4V21H9z"/></svg>
      </a>
      <a href="https://github.com/NFMofrad" target="_blank" rel="noopener" aria-label="GitHub">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5a11.5 11.5 0 0 0-3.64 22.42c.58.11.8-.25.8-.56v-2.1c-3.26.71-3.95-1.4-3.95-1.4-.53-1.34-1.3-1.7-1.3-1.7-1.07-.74.08-.72.08-.72 1.18.08 1.8 1.22 1.8 1.22 1.05 1.79 2.76 1.27 3.43.97.11-.77.41-1.27.75-1.56-2.6-.29-5.33-1.3-5.33-5.8 0-1.28.46-2.33 1.22-3.15-.12-.3-.53-1.53.12-3.18 0 0 1-.32 3.28 1.2a11.4 11.4 0 0 1 5.98 0c2.28-1.52 3.28-1.2 3.28-1.2.65 1.65.24 2.88.12 3.18.76.82 1.22 1.87 1.22 3.15 0 4.51-2.74 5.51-5.36 5.8.42.36.8 1.06.8 2.14v3.17c0 .31.21.68.81.56A11.5 11.5 0 0 0 12 .5z"/></svg>
      </a>
      <a href="https://scholar.google.com/citations?user=mB8VHhwAAAAJ&hl=en" target="_blank" rel="noopener" aria-label="Google Scholar">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Google_Scholar_logo.svg/512px-Google_Scholar_logo.svg.png" alt="" width="18" height="18" loading="lazy">
      </a>
      <a href="https://orcid.org/0009-0001-6702-6702" target="_blank" rel="noopener" aria-label="ORCID">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/ORCID_iD.svg/512px-ORCID_iD.svg.png" alt="" width="18" height="18" loading="lazy">
      </a>
    </div>

    <div class="contact">
      Email: <a href="mailto:nima.fakhrayimofrad@aalto.fi">nima.fakhrayimofrad@aalto.fi</a>
    </div>
  </div>
</header>

<div class="rule"></div>

<section class="bio-section">
  <h2>About Me</h2>
  <div class="bio-card">
    <div class="marker"></div>
    <p style="text-align: justify;">Hi! Iâ€™m Nima, a computational materials scientist who loves exploring materials at the atomic scale. I work with <strong>molecular dynamics</strong>, <strong>DFT</strong>, and <strong>machine learning</strong> to study plasma-surface interactions and material behavior. Python is my go-to for crunching data and building efficient, reproducible workflows.</p>
  </div>
</section>

<section id="experience">
  <h2>Research Highlights</h2>
  <div class="research-grid">

    <div class="research-card">
      <div class="marker"></div>
      <h3>Mechanical Properties of Polyolefin Chains</h3>
      <video autoplay loop muted playsinline style="width:100%;height:auto;border-radius:8px;">
        <source src="PS.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <p style="text-align: justify;">Exploring the mechanical response of polyolefin chains using reactive Langevin dynamics simulations with stereochemical control.</p>
      <div class="subprojects">
        <a class="subproject" href="https://github.com/NFMofrad/Sputtering" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 .2a7.8 7.8 0 1 0 0 15.6A7.8 7.8 0 0 0 8 .2z"/></svg>
          <span class="title">Polymer Chain Analysis</span>
          <span class="spacer"></span><span aria-hidden="true">â†—</span>
        </a>
      </div>
	  <hr class="divider">
      <div class="chips"><span class="chip">Reactive MD</span><span class="chip">LAMMPS</span><span class="chip">Python</span></div>
    </div>

    <div class="research-card">
      <div class="marker"></div>
      <h3>Plasma-wall Interactions in Fusion Reactors</h3>
      <img src="rovib_temp_Be.png" alt="Rovibrational analysis of Beâ€“D system" style="width:100%;height:auto;border-radius:8px;" loading="lazy" decoding="async">
      <p style="text-align: justify;">Atomic-scale modeling of plasma-surface interactions, including molecular sputtering of Beâ€“D and Wâ€“D systems.</p>
      <div class="subprojects">
        <a class="subproject" href="https://github.com/NFMofrad/Sputtering" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 .2a7.8 7.8 0 1 0 0 15.6A7.8 7.8 0 0 0 8 .2z"/></svg>
          <span class="title">PWI Analysis</span>
          <span class="spacer"></span><span aria-hidden="true">â†—</span>
        </a>
      </div>
	  <hr class="divider">
      <div class="chips"><span class="chip">LAMMPS</span><span class="chip">Python</span><span class="chip">Data Analysis</span><span class="chip">DFT</span></div>
    </div>

    <div class="research-card">
      <div class="marker"></div>
      <h3>High-Performance Computing & Data Analysis</h3>
      <p style="text-align: justify;">Development of scalable workflows and analysis pipelines for large-scale molecular dynamics simulations.</p>
      <div class="subprojects">
        <a class="subproject" href="https://github.com/NFMofrad/Sputtering" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 .2a7.8 7.8 0 1 0 0 15.6A7.8 7.8 0 0 0 8 .2z"/></svg>
          <span class="title">Data Analysis</span>
          <span class="spacer"></span><span aria-hidden="true">â†—</span>
        </a>
      </div>
	  <hr class="divider">
      <div class="chips"><span class="chip">Python</span><span class="chip">NumPy</span><span class="chip">Pandas</span><span class="chip">Matplotlib</span><span class="chip">HPC</span></div>
    </div>

    <div class="research-card">
      <div class="marker"></div>
      <h3>Machine Learning for Materials Research</h3>
      <p style="text-align: justify;">Application of ML models to predict properties and behavior of materials at the atomic and molecular scale.</p>
      <div class="subprojects">
        <a class="subproject" href="https://github.com/NFMofrad/Sputtering" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 .2a7.8 7.8 0 1 0 0 15.6A7.8 7.8 0 0 0 8 .2z"/></svg>
          <span class="title">MLIP</span>
          <span class="spacer"></span><span aria-hidden="true">â†—</span>
        </a>
      </div>
	  <hr class="divider">
      <div class="chips"><span class="chip">Machine Learning</span><span class="chip">scikit-learn</span><span class="chip">Python</span></div>
    </div>

  </div>
</section>

<section id="recent-activities" class="activities">
  <h2>Activities</h2>

  <div class="act-controls" aria-label="Filter activities by type" role="group">
    <button class="pill" data-filter="All" aria-pressed="true">All</button>
    <button class="pill" data-filter="Paper" aria-pressed="false">Paper</button>
    <button class="pill" data-filter="Talk" aria-pressed="false">Talk</button>
    <button class="pill" data-filter="Position" aria-pressed="false">Position</button>
  </div>

  <div class="rail-shell">
    <div id="activitiesRail" class="activities-rail" role="list" aria-label="Recent activities"></div>
  </div>
</section>

<h2>Networks</h2>
<section class="collab-static" aria-label="Static map with collaboration pins">
  <img class="map" src="worldmap.jpg" alt="World map (equirectangular)" loading="lazy" decoding="async" />
  <div id="pins" aria-hidden="false"></div>
</section>

<script>
/* ===== Utilities ===== */
const qs  = (s, r=document) => r.querySelector(s);
const qsa = (s, r=document) => Array.from(r.querySelectorAll(s));

/* ===== Theme ===== */
(function initTheme(){
  const root = document.documentElement;
  const btn  = qs('#themeBtn');
  function currentPrefersDark(){ return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; }
  function setTheme(mode){
    if(mode === 'dark'){ root.setAttribute('data-theme','dark'); btn.textContent='â˜€ï¸ Day'; btn.setAttribute('aria-pressed','true'); }
    else{ root.removeAttribute('data-theme'); btn.textContent='ðŸŒ™ Night'; btn.setAttribute('aria-pressed','false'); }
    localStorage.setItem('theme', mode);
  }
  function toggleTheme(){
    const isDark = root.getAttribute('data-theme') === 'dark';
    setTheme(isDark ? 'light' : 'dark');
  }
  const saved = localStorage.getItem('theme');
  if(saved){ setTheme(saved); }
  else { setTheme(currentPrefersDark() ? 'dark' : 'light'); }
  btn.addEventListener('click', toggleTheme);
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener?.('change', e=>{
    const savedNow = localStorage.getItem('theme');
    if(!savedNow){ setTheme(e.matches ? 'dark' : 'light'); }
  });
})();

/* ===== Typewriter & Social reveal ===== */
(function initTypewriter(){
  const phrase = "Computational Materials Scientist (Ph.D. Candidate)";
  const el = qs("#tw-text");
  const cursor = qs(".cursor");
  const socials = qs(".social");
  if (!el || !cursor || !socials) return;
  const reduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if (reduced) {
    el.textContent = phrase;
    socials.classList.remove("hidden");
    cursor.style.display = "none";
    return;
  }
  let j = 0;
  const speed = 30;
  (function typeOnce(){
    if (j < phrase.length){
      el.textContent = phrase.slice(0, ++j);
      setTimeout(typeOnce, speed);
    } else {
      socials.classList.remove("hidden");
      cursor.style.display = "none";
    }
  })();
})();

/* ===== Activities (Data-driven) ===== */
const ACTIVITIES = [
  {
    type:"Paper",
    dateISO:"2025-09-10",
    title:"Active polar polymer assemblies â€” preprint out",
    href:"https://doi.org/10.48550/arXiv.2503.11396",
    linkText:"Read"
  },
  {
    type:"Talk",
    dateISO:"2025-07-02",
    title:"Invited talk: Polyelectrolyte adsorption & dielectric contrast",
    href:"https://doi.org/10.1063/5.0223124",
    linkText:"Related"
  }
];

(function initActivities(){
  const rail = qs('#activitiesRail');
  function fmtDate(iso){
    try{
      const d = new Date(iso+"T12:00:00Z");
      const opt = { month:'short', day:'numeric', year:'numeric' };
      return d.toLocaleDateString(undefined, opt);
    }catch{ return iso; }
  }
  function activityNode(a){
    const item = document.createElement('div');
    item.className = 'activity-line';
    item.setAttribute('role','listitem');
    item.dataset.type = a.type;
    item.innerHTML = `
      <time class="act-date" datetime="${a.dateISO}">${fmtDate(a.dateISO)}</time>
      <span class="act-type">${a.type}</span>
      <div class="act-title"><a href="${a.href}" target="_blank" rel="noopener">${a.title}</a></div>
      <a class="act-link" href="${a.href}" target="_blank" rel="noopener">${a.linkText || 'Open'}</a>
    `;
    return item;
  }
  function renderActivities(data){
    rail.innerHTML = "";
    data
      .slice()
      .sort((a,b)=> b.dateISO.localeCompare(a.dateISO))
      .forEach(a => rail.appendChild(activityNode(a)));
  }
  renderActivities(ACTIVITIES);

  /* Filtering */
  const pills = qsa('.pill[data-filter]');
  function applyFilter(type){
    qsa('.activity-line', rail).forEach(r=>{
      const ok = (type==='All') || (r.dataset.type === type);
      r.style.display = ok ? 'grid' : 'none';
    });
  }
  pills.forEach(p=>{
    p.addEventListener('click', ()=>{
      pills.forEach(x=>x.setAttribute('aria-pressed','false'));
      p.setAttribute('aria-pressed','true');
      applyFilter(p.dataset.filter);
    });
    p.addEventListener('keydown', e=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); p.click(); }
    });
  });
})();

/* ===== Collaboration map (improved positioning) ===== */
(function initMap(){
  const SITES = [
    { title:"Home â€” UEF, Joensuu", desc:"Lead: Dr. Arsalan Hashemi. Physics-informed chemistry and machine-learning workflows for energy and materials.", lat:62.6, lon:29.8, cls:"c-fi", active:true, home:true },
    { title:"Germany â€” Berlin", desc:"Collaborator: Dr. Hossein Vahid. Electrolyte modeling for developing water purification and desalination.", lat:52.5200, lon:13.4050, cls:"c-de", active:true },
    { title:"USA â€” Washington, DC", desc:"Collaborator: Prof. Jane Doe. Defects in 2D semiconductors; multiscale simulations bridging DFT and ML potentials.", lat:38.9072, lon:-77.0369, cls:"c-us", active:true },
    { title:"UK â€” London", desc:"Collaborator: Dr. Sara Khan. Raman and photoluminescence workflows for layered materials under strain.", lat:51.5074, lon:-0.1278, cls:"c-uk", active:true },
    { title:"USA â€” Cambridge, MA", desc:"Collaborator: Dr. Alex Miller. Electrochemical COâ‚‚ reduction: solvent effects, ion pairing, and reactive transport modeling.", lat:42.3736, lon:-71.1097, cls:"c-us", active:false },
    { title:"China â€” Shanghai", desc:"Collaborator: Dr. Li Chen. Battery electrolytes: data curation, surrogate models, and uncertainty quantification.", lat:31.2304, lon:121.4737, cls:"c-cn", active:false }
  ];

  // If your map image is centered at a different meridian (e.g. 180), set this to that value (degrees).
  // For standard maps use 0.
  const centralMeridian = 0; // change to 180 if your map's center is 180Â°E

  const mount = qs("#pins");
  const container = mount.closest('.collab-static');
  const img = qs('.collab-static img.map');

  // helper: convert lon->x pixel and lat->y pixel on an equirectangular image
  function lonLatToImagePixels(lon, lat, imgWidth, imgHeight) {
    // Shift longitude by central meridian
    let shiftedLon = lon - centralMeridian;
    while (shiftedLon < -180) shiftedLon += 360;
    while (shiftedLon > 180) shiftedLon -= 360;
  
    // Mercator projection math
    const x = ((shiftedLon + 180) / 360) * imgWidth;
  
    // Clamp latitude to avoid infinity at poles
    const latRad = lat * Math.PI / 180;
    const mercN = Math.log(Math.tan(Math.PI / 4 + latRad / 2));
    const y = (imgHeight / 2) - (imgWidth * mercN / (2 * Math.PI));
  
    return { x, y };
  }

  function truncateWords(str, max){ const w=(str||"").trim().split(/\s+/); return w.length<=max?str:w.slice(0,max).join(" ")+"â€¦"; }

  function layoutPins(){
    mount.innerHTML = "";

    // Make sure image has rendered size; if not, wait until it loads
    const imgWidth  = img.clientWidth  || img.naturalWidth;
    const imgHeight = img.clientHeight || img.naturalHeight;

    // image offset inside container (left/top) â€” important when image does not fill container completely
    const imgRect = img.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const imgOffsetLeft = imgRect.left - containerRect.left;
    const imgOffsetTop  = imgRect.top  - containerRect.top;

    SITES.forEach(s=>{
      const { x: px, y: py } = lonLatToImagePixels(s.lon, s.lat, imgWidth, imgHeight);

      // Create pin
      const pin = document.createElement("div");
      pin.className = `pin ${s.cls||""} ${s.active===false?"inactive":""} ${s.home?"home":""}`;
      // Position pin using image pixel + image offset -> convert to container px
      const leftPx = imgOffsetLeft + px;
      const topPx  = imgOffsetTop  + py;
      pin.style.left = leftPx + "px";
      pin.style.top  = topPx  + "px";
      pin.setAttribute("tabindex","0");
      pin.setAttribute("aria-label", s.title || s.desc || "collaborator");

      const stem=document.createElement("div"); stem.className="stem";
      const ring=document.createElement("div"); ring.className="ring";
      const dot=document.createElement("div"); dot.className="dot";
      pin.append(stem, ring, dot);
      if(s.home){ const ring2=document.createElement("div"); ring2.className="ring2"; pin.append(ring2); }
      mount.appendChild(pin);

      // Create card
      const card=document.createElement("div"); card.className=`collab-card ${s.active===false?"inactive":""}`;
      const caret=document.createElement("div"); caret.className="collab-caret";
      const title=document.createElement("div"); title.className="card-title"; title.textContent = s.title || "";
      const body=document.createElement("div"); body.className="card-body"; body.textContent = truncateWords(s.desc || "", 30);
      card.append(title, body, caret);
      mount.appendChild(card);

      // Place card near the pin: prefer to the right, but flip when near edge
      function placeCard(){
        const pad = 8;
        const gap = 12;
        const cw = container.clientWidth, ch = container.clientHeight;
        const cx = leftPx, cy = topPx;
        const w = Math.min(card.offsetWidth || 150, cw - 2*pad);
        const h = Math.min(card.offsetHeight || 90, ch - 2*pad);
        let left = cx + gap, rightSide = true;
        if(left + w + pad > cw){ left = cx - gap - w; rightSide = false; }
        left = Math.max(pad, Math.min(left, cw - w - pad));
        let top = cy - h/2; top = Math.max(pad, Math.min(top, ch - h - pad));
        card.style.left = left + 'px'; card.style.top = top + 'px';
        card.classList.toggle('place-right', rightSide);
        card.classList.toggle('place-left', !rightSide);
      }

      const open=()=>card.classList.add('open'), close=()=>card.classList.remove('open');
      pin.addEventListener('mouseenter', open); pin.addEventListener('mouseleave', close);
      card.addEventListener('mouseenter', open); card.addEventListener('mouseleave', close);
      pin.addEventListener('click', ()=>card.classList.toggle('open'));
      pin.addEventListener('keydown', e=>{
        if(e.key==='Enter' || e.key===' '){ e.preventDefault(); card.classList.toggle('open'); }
        if(e.key==='Escape'){ close(); }
      });

      // Position the card now and when window resizes
      placeCard();
      window.addEventListener('resize', placeCard);
    });
  }

  // If image hasn't loaded yet, wait for it
  if(!img.complete || img.naturalWidth === 0){
    img.addEventListener('load', layoutPins, { once: true });
    // also try after a slight delay in case of responsive layout adjustments
    setTimeout(() => { if(img.complete) layoutPins(); }, 250);
  } else {
    layoutPins();
  }

  // If layout changes (e.g. fonts load, container resized), relayout pins
  const ro = new ResizeObserver(()=>{ if(img.complete) layoutPins(); });
  ro.observe(container);
  ro.observe(img);
})();
</script>
</body>
</html>
